{% extends "base_library.html" %}
{% load static %}

{% block title %}Biblioteca - NearBeats{% endblock %}

{% block content %}

<div class="library-intro-compact mb-4">
  <div class="intro-content text-center p-4">
    <h2 class="fw-bold mb-3">Tu Biblioteca Personal</h2>
    <div class="intro-features mb-3">
      <span class="feature-badge">
        <i class="bi bi-collection-play me-1"></i>Descubre
      </span>
      <span class="feature-badge">
        <i class="bi bi-heart me-1"></i>Disfruta
      </span>
      <span class="feature-badge">
        <i class="bi bi-star me-1"></i>Colecciona
      </span>
      <span class="feature-badge">
        <i class="bi bi-share me-1"></i>Comparte
      </span>
    </div>
    <p class="intro-description text-muted mx-auto mb-0">
      Tu espacio personal para explorar canciones únicas, seguir artistas emergentes 
      y construir tu colección musical que refleje tu estilo.
    </p>
  </div>
</div>

<div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-3">
  {% for song in songs %}
    <div class="col">
      <div class="song-card h-100 d-flex flex-column">
        
        <!-- Portada -->
        <div class="song-cover">
          {% if song.cover_image %}
            <img src="{{ song.cover_image.url }}" alt="{{ song.title }}">
          {% else %}
            <img src="{% static 'images/sin_portada.png' %}" alt="Sin portada">
          {% endif %}
          <div class="play-btn" 
              data-song-id="{{ song.id }}"
              data-audio="{{ song.audio_file.url }}"
              data-title="{{ song.title }}"
              data-artist="{{ song.artist_name }}">
            <i class="bi bi-play-fill"></i>
          </div>
        </div>

        <!-- Información -->
        <div class="song-info text-center p-2">
          <div class="song-title fw-semibold text-truncate">{{ song.title }}</div>
          <div class="song-artist text-muted small text-truncate">{{ song.artist_name }}</div>
          <!-- Seguidores del artista -->
          <button class="btn btn-link p-0 comment-btn" data-artist-id="{{ song.artist_name }}" onclick="showFollowersCount(this)" title="Ver seguidores">
            <i class="bi bi-eye"></i>
          </button>
          <!-- Fecha creacion cancion -->
          <div class="song-date text-muted small">
            {{ song.created_at|date:"d M Y" }}
            <i class="bi bi-clock" style="font-size: 0.8rem;"></i>
          </div>
        </div>

        <!-- Acciones -->
        {% if user.is_authenticated %}
          <div class="d-flex justify-content-between align-items-center px-2 pb-2">    
            <!-- Izquierda -->
            <div class="d-flex gap-2">
              <button class="btn btn-link p-0 favorite-btn" data-song-id="{{ song.id }}" title="Agregar a favoritos">
                <i class="bi bi-star{% if song.is_favorited %}-fill text-warning{% endif %}" style="font-size: 1.2rem;"></i>
              </button>
              <button class="btn btn-link p-0 share-btn" data-song-id="{{ song.id }}" onclick="share_song('{{ song.title }}')" title="Compartir canción">
                <i class="bi bi-share-fill" style="font-size: 1.2rem;"></i>
              </button>
              <button class="btn btn-link p-0 follow-btn" data-artist-id="{{ song.artist_name }}" onclick="follow_artist(this)" title="Seguir artista">
                <i class="bi bi-person-plus{% if song.is_followed %}-fill text-success{% endif %}" style="font-size: 1.2rem;"></i>
              </button>
            </div>

            <!-- Derecha  -->
             <!-- fecha creacion -->
            <div class="d-flex align-items-center gap-1">
              <button class="btn btn-link p-0 like-btn" data-song-id="{{ song.id }}" title="Me gusta">
                <i class="bi bi-heart{% if song.is_liked %}-fill text-danger{% endif %}" style="font-size: 1.2rem;"></i>
              </button>
              <span id="likes-count-{{ song.id }}" 
                    class="px-2 py-0 rounded-pill"
                    style="font-size: 0.7rem; background-color: #f1f1f1; color: #555;">
                {{ song.likes_count }}
              </span>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

{% endblock %}
