{% extends 'main/base.html' %}
{% load static %}

{% block content %}
<div class="profile-max artist-profile">
    <!-- Indicador de ubicación dinámico -->
    <div class="location-indicator">
        <div class="d-flex align-items-center mb-3">
            <div class="custom-breadcrumb">
                 <a href="{% url 'home' %}" class="breadcrumb-item">
                        <i class="bi bi-house-door me-1"></i>
                        <span>Inicio</span>
                </a>
                  <span class="breadcrumb-divider mx-2">
                    <i class="bi bi-chevron-right text-muted"></i>
                </span>
                {% if request.META.HTTP_REFERER %}
                    {% if 'library' in request.META.HTTP_REFERER or 'favorites' in request.META.HTTP_REFERER or 'upload' in request.META.HTTP_REFERER  or 'playlist' in request.META.HTTP_REFERER%}
                        <a href="{% url 'see_library' %}" class="breadcrumb-item">
                            <i class="bi bi-collection-play me-1"></i>
                            <span>Biblioteca</span>
                        </a>
                    {% endif %}
                {% endif %}
                
                <span class="breadcrumb-divider mx-2">
                    <i class="bi bi-chevron-right text-muted"></i>
                </span>
                
                <span class="breadcrumb-item active">
                    <i class="bi bi-person-circle me-1"></i>
                    <span>Perfil de {{ artist_name }}</span>
                </span>
            </div>
        </div>
    </div>

    <!-- Bloque principal del artista -->
    <section class="hero" aria-label="Tarjeta de artista">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-12 col-md-auto">
                    <figure class="avatar" aria-label="Imagen de perfil">
                        {% if artist_profile.profile_image %}
                            <img src="{{ artist_profile.profile_image.url }}" alt="Imagen de {{ artist_name }}">
                        {% else %}
                            <img src="https://www.fmdos.cl/wp-content/uploads/2025/06/Jessie-J-cancer.webp" alt="Foto del artista">
                        {% endif %}
                    </figure>
                </div>
                <div class="col-12 col-md-9">
                    <div class="title-wrap">
                        <h1 class="artist">{{ artist_name }}</h1>
                    </div>
                    <div id="repro-mes-container" class="mb-2 repro-pill d-inline-flex align-items-center gap-2">
                        <i class="bi bi-activity"></i>
                        <span class="repro-label">Reproducciones mensuales</span>
                        <strong class="repro-count ms-2">{{ plays_this_month }}</strong>
                    </div>
                    <div class="artist-bio mt-3">
                        <p class="bio">{{ artist_profile.bio }}</p>
                    </div>
                    <div class="artist-socials mt-3 d-flex align-items-center">
                        <a href="{{ artist_profile.website|default:'https://www.google.com/' }}" target="_blank" rel="noopener" class="social-link me-2" aria-label="Website">
                            <i class="bi bi-globe"></i>
                        </a>
                        <a href="{{ artist_profile.instagram|default:'https://www.instagram.com/' }}" target="_blank" rel="noopener" class="social-link me-2" aria-label="Instagram">
                            <i class="bi bi-instagram"></i>
                        </a>
                        <a href="{{ artist_profile.twitter|default:'https://x.com/?lang=es' }}" target="_blank" rel="noopener" class="social-link me-2" aria-label="Twitter">
                            <i class="bi bi-twitter"></i>
                        </a>
                    </div>
                    <div class="mt-3 d-flex align-items-center gap-2">
                        <button id="play-tracks-btn" class="btn btn-primary view-btn active">Canciones</button>
                        <button id="stats-btn" class="btn btn-outline-secondary view-btn">Estadísticas</button>
                        <button id="share-btn" class="btn btn-light ms-2">Share</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Canciones del artista -->
    <section class="artist_songs" id="tracks-section">
        <div class="main-block-profile">
            {% for song in songList %}
                <article class="card mb-3 track-item">
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="{{ song.cover_image.url }}" class="img-fluid rounded-start" alt="{{ song.title }}">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 class="card-title">{{ song.title }}</h5>
                                <p class="card-text"><small class="text-body-secondary">{{ song.genre }}</small></p>
                                {% if song.audio_file %}
                                    <audio controls class="w-100">
                                        <source src="{{ song.audio_file.url }}" type="audio/mpeg">
                                        Tu navegador no soporta reproducción de audio.
                                    </audio>
                                {% else %}
                                    <small class="text-muted">Audio no disponible</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </article>
            {% empty %}
                <p class="text-muted">Este artista aún no tiene canciones disponibles.</p>
            {% endfor %}
        </div>
    </section>

    <!-- Estadísticas  -->
    <section class="artist-grid d-none" id="stats-section" aria-label="Contenido del perfil">
        <aside class="card" aria-label="Analítica del artista">
            <h3>Analítica</h3>
            <div class="row charts-row">
                <div class="col-12 col-md-6 mb-3">
                    <div class="chart" aria-label="Gráfico de Top canciones">
                        <h5>Top canciones</h5>
                        <canvas id="topSongsChart" width="400" height="200"></canvas>
                    </div>
                </div>
                <div class="col-12 col-md-6 mb-3">
                    <div class="chart" aria-label="Gráfico de reproducciones por hora">
                        <h5>Reproducciones por hora este mes</h5>
                        <canvas id="hourLineChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
            <p class="note">Más información sobre las gráficas.</p>
        </aside>
    </section>


    <!-- Datos para JS y scripts -->
    {{ plays_this_month|json_script:"plays_this_month" }}
    {{ song_names|json_script:"song_names" }}
    {{ play_counts|json_script:"play_counts" }}
    {{ hour_labels|json_script:"hour_labels" }}
    {{ hour_data|json_script:"hour_data" }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'artist/js/graphic.js' %}"></script>
</div>
{% endblock %}