{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}NearBeats{% endblock %}</title>
  
  <!-- Bootstrap FIRST -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  
  <!-- Estilos -->
  <link rel="icon" href="{% static 'images/NearBeats_SF.png' %}" type="image/png" />
  <link rel="stylesheet" href="{% static 'css/style_BaseLibrary.css' %}?v=1">
  <link rel="stylesheet" href="{% static 'css/styleLibrary.css' %}?v=1">
  <link rel="stylesheet" href="{% static 'css/styleFavorites.css' %}?v=1">
  <link rel="stylesheet" href="{% static 'main/css/estilo.css' %}?v=1">

  {% block extra_css %}{% endblock %}
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar fade-in">
    <div class="logo-container">
      <div class="logo">
        <img src="{% static 'images/NearBeats_SF.png' %}" alt="NearBeats">
        <span class="brand-name">NearBeats</span>
      </div>
      <div class="divider"></div>
    </div>

    <ul class="nav-links">
      <li>
        <a href="{% url 'see_library' %}" 
           class="{% if request.resolver_match.url_name == 'see_library' %}active{% endif %}">
           <i class="bi bi-search"></i> Explorar
        </a>
      </li>

      {% if user.is_authenticated and user.rol == "Artista" %}
        <li>
          <a href="{% url 'upload_songs' %}" 
             class="{% if request.resolver_match.url_name == 'upload_songs' %}active{% endif %}">
             <i class="bi bi-cloud-upload"></i> Subir canciones
          </a>
        </li>
      {% endif %}

    
      {% if user.is_authenticated %}
      <li>
        <a href="{% url 'favorites' %}" 
           class="{% if request.resolver_match.url_name == 'favorites' %}active{% endif %}">
           <i class="bi bi-star-fill"></i> Favoritos
        </a>
      </li>
        <li>
        <a href="{% url 'playlists' %}">
           <i class="bi bi-music-note-list"></i> Playlists
        </a>
      </li>
       {% endif %}
    </ul>
   

    <!-- Si el usuario NO est치 logueado -->
    <div class="bottom-buttons mt-auto p-2">
      {% if not user.is_authenticated %}
        <a href="{% url 'login' %}" class="login-card">
          <div>
            <div class="login-title">游꿨 Inicia sesi칩n</div>
            <div class="login-subtitle">
              y desbloquea tu <span>experiencia musical</span>
            </div>
          </div>
        </a>
      {% endif %}
    </div>
  </aside>
  

  <!-- Contenido principal -->
  <main class="main-content fade-in">
    <!-- Barra de navegaci칩n secundaria -->
    {% include 'main/main_navbar.html' %}

    <!-- Indicador de ubicaci칩n universal -->
        <!-- Indicador de ubicaci칩n universal -->
    <div class="location-indicator mb-4">
      <div class="d-flex align-items-center mb-3">
        <!-- Breadcrumb personalizado DIN츼MICO -->
        <div class="custom-breadcrumb">
          <a href="{% url 'home' %}" class="breadcrumb-item">
            <i class="bi bi-house-door me-1"></i>
            <span>Inicio</span>
          </a>
          <span class="breadcrumb-divider mx-2">
            <i class="bi bi-chevron-right text-muted"></i>
          </span>
          <a href="{% url 'see_library' %}" class="breadcrumb-item">
            <i class="bi bi-collection-play me-1"></i>
            <span>Biblioteca</span>
          </a>
          
          {% comment %} L칩gica para Playlists {% endcomment %}
          {% if 'playlist' in request.resolver_match.url_name %}
            {% if request.resolver_match.url_name == 'playlists' %}
              {% comment %} Estamos en la p치gina principal de playlists - solo mostrar como activo {% endcomment %}
              <span class="breadcrumb-divider mx-2">
                <i class="bi bi-chevron-right text-muted"></i>
              </span>
              <span class="breadcrumb-item active">
                <i class="bi bi-music-note-list me-1"></i>
                <span>Mis Playlists</span>
              </span>
            {% else %}
              {% comment %} Estamos en una subp치gina de playlists - mostrar enlace + p치gina actual {% endcomment %}
              <span class="breadcrumb-divider mx-2">
                <i class="bi bi-chevron-right text-muted"></i>
              </span>
              <a href="{% url 'playlists' %}" class="breadcrumb-item">
                <i class="bi bi-music-note-list me-1"></i>
                <span>Mis Playlists</span>
              </a>
              
              {% comment %} P치gina actual espec칤fica {% endcomment %}
              {% if request.resolver_match.url_name == 'create_playlist' %}
              <span class="breadcrumb-divider mx-2">
                <i class="bi bi-chevron-right text-muted"></i>
              </span>
              <span class="breadcrumb-item active">
                <i class="bi bi-plus-circle me-1"></i>
                <span>Crear Playlist</span>
              </span>
              {% elif request.resolver_match.url_name == 'playlist_detail' %}
              <span class="breadcrumb-divider mx-2">
                <i class="bi bi-chevron-right text-muted"></i>
              </span>
              <span class="breadcrumb-item active">
                <i class="bi bi-info-circle me-1"></i>
                <span>Detalles Playlist</span>
              </span>
              {% endif %}
            {% endif %}
          {% else %}
            {% comment %} No estamos en p치ginas de playlists - usar blocks normales {% endcomment %}
            <span class="breadcrumb-divider mx-2">
              <i class="bi bi-chevron-right text-muted"></i>
            </span>
            <span class="breadcrumb-item active">
              <i class="{% block page_icon %}bi bi-compass{% endblock %} me-1"></i>
              <span>{% block page_name %}Explora{% endblock %}</span>
            </span>
          {% endif %}
        </div>
      </div>
    </div>
      
    

    <!-- Contenido espec칤fico de cada p치gina -->
    {% block content %}{% endblock %}
  </main>

  <!-- Player bar -->
<div id="player-bar">
  <div id="player-left">
    <img id="cover-img" src="{% static 'images/sin_portada.png' %}" alt="Cover">
    <div id="player-song-info">
      <div id="player-title">No hay canci칩n</div>
      <div id="player-artist">---</div>
    </div>
  </div>

  <div id="player-center">
    <div id="player-controls">
      <button id="rewind-btn" title="Retroceder 10 segundos"><i class="bi bi-skip-backward-fill"></i></button>
      <button id="playpause-btn" title="Reproducir / Pausar"><i class="bi bi-play-fill"></i></button>
      <button id="forward-btn" title="Adelantar 10 segundos"><i class="bi bi-skip-forward-fill"></i></button>
    </div>

    <div id="progress-container">
      <span id="current-time">0:00</span>
      <div id="progress-bar" title="Barra de progreso">
        <div id="progress-fill"></div>
        <div id="progress-thumb"></div> <!-- <- Esta es la bolita draggable -->
      </div>
      <span id="duration">0:00</span>
    </div>
  </div>

  <audio id="audio-player"></audio>
</div>

  <div class="modal fade" id="followersModal" tabindex="-1" aria-labelledby="followersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="followersModalLabel">Seguidores del artista</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <span id="followers-count" style="font-size:2rem;"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS FIRST -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Tus scripts despu칠s de Bootstrap -->
  <script src="{% static 'main/js/search.js' %}"></script>
  <script src="{% static 'js/player.js' %}"></script>
  <script src="{% static 'js/like.js' %}"></script>
  <script src="{% static 'js/favorite.js' %}"></script>
  <script src="{% static 'js/follows.js' %}"></script>
  <script src="{% static 'library/js/play_counter.js' %}"></script>


  {% block extra_js %}{% endblock %}

</body>
</html>